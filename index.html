<!doctype html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
        integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
        integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx"
        crossorigin="anonymous"></script>

    <!-- Custom CSS -->
    <title>Task</title>
</head>

<body>
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <h3 class="text-primary">Total number of employees</h3>
                <hr>
                <div class="d-flex bd-highlight mb-3" class="form-group">
                    <div class="p-2 bd-highlight">
                        <div class="dropdown">
                            <select class="form-control" onchange="filterDepartment(this.value)">
                                <option value="" selected>Department</option>
                                <option value="Computer">Computer </option>
                                <option value="Physics">Physics</option>
                                <option value="Chemistry"> Chemistry </option>
                            </select>
                        </div>
                    </div>
                    <div class="p-2 bd-highlight">
                        <input type="text" class="form-control" placeholder="Name/Email" name="search" id="searchBox">
                    </div>
                    <div class="p-2">
                        <button class="btn btn-primary" type="submit" onclick="search()">Search</button>
                    </div>
                    <div class="p-2 bd-highlight">
                        <button type="button" onclick="reset()" class="btn btn-danger">Reset and reload data</button>
                    </div>
                    <div class="ml-auto p-2 bd-highlight">
                        <select class="form-control" onchange="onSort(this.value)">
                            <option disabled value="">Sort By</option>
                            <option selected value="nameaz">Name(a-z)</option>
                            <option value="nameza">Name(z-a)</option>
                            <option value="emailaz">Email(a-z)</option>
                            <option value="emailza">Email(z-a)</option>
                            <option value="ageaz">Age(a-z)</option>
                            <option value="ageza">Age(z-a)</option>
                        </select>
                    </div>
                </div>


                <table id="myTable" class="table table-striped table-bordered">
                    <thead>
                        <tr>
                            <th>Emp Name</th>
                            <th>Age</th>
                            <th>Email Address</th>
                            <th>No. of Departments</th>
                        </tr>
                    </thead>
                    <tbody id="tbody"></tbody>

                </table>
                <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.0/jquery.min.js"></script>
                <script src="data.js"></script>
                <script>
                    loadTable(employees);
                    let filteredDepartment = employees;
                    // load table...
                    function loadTable(data) {
                        let html = "";
                        data.forEach(element => {
                            html += `<tr>
                                    <td>${element.name}</td>
                                    <td>${element.age}</td>
                                    <td>${element.email}</td>
                                    <td><p data-toggle="tooltip" data-html="true" title="${element.departments.join(", ")}">${element.departments.length}</p></td>
                                </tr>`
                        });
                        $("#tbody").html(html);
                    }

                    // filter by departments
                    function filterDepartment(department) {
                        if (department == "") {
                            loadTable(employees);
                            filteredDepartment = employees;

                            return;
                        }
                        filteredDepartment = employees.filter(emp => {
                            let { departments } = emp;
                            return departments.indexOf(department) != -1;
                        });
                        loadTable(filteredDepartment);
                    }

                    // search employees
                    function search() {
                        let searchVal = $("#searchBox").val();
                        searchVal = searchVal.trim().toLowerCase();
                        if (!searchVal) {
                            loadTable(filteredDepartment);
                            return;
                        }

                        let searchResult = filteredDepartment.filter(emp => {
                            let { name, email } = emp;
                            return name.toLowerCase() === searchVal || email.toLowerCase() === searchVal
                        });
                        loadTable(searchResult);
                    }

                    // on sorting data

                    function onSort(val) {
                        alert(val);
                    }

                    // Reset and realod
                    function reset() {
                        loadTable(employees);
                        $("#searchBox").val("");

                    }





                    // selectfilter($('table'), $('#select').val());

                    // $('#select').change(function () {
                    //     var selection = $(this).val();
                    //     $('table').find('tr').show();
                    //     selectfilter($('table'), selection);
                    // });

                    // function selectfilter(table, selection) {
                    //     table.find('tr').filter(function (index, item) {
                    //         return $(item).find('td:first-child').text().split(',').indexOf(selection) === -1;
                    //     }).hide();
                    // }
                </script>
                <script>
                    function myFunction() {
                        var input, filter, table, tr, td, i, txtValue;
                        input = document.getElementById("myInput");
                        filter = input.value.toUpperCase();
                        table = document.getElementById("myTable");
                        tr = table.getElementsByTagName("tr");
                        for (i = 0; i < tr.length; i++) {
                            td = tr[i].getElementsByTagName("td")[0];
                            if (td) {
                                txtValue = td.textContent || td.innerText;
                                if (txtValue.toUpperCase().indexOf(filter) > -1) {
                                    tr[i].style.display = "";
                                } else {
                                    tr[i].style.display = "none";
                                }
                            }
                        }
                    }
                </script>

            </div>
        </div>
    </div>

</body>

</html>